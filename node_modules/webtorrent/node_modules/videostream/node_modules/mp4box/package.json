{
  "name": "mp4box",
  "version": "0.1.0",
  "description": "JavaScript version of GPAC's MP4Box tool",
  "keywords": [
    "mp4",
    "MSE",
    "streaming"
  ],
  "homepage": "https://github.com/gpac/mp4box.js",
  "main": "src/mp4box.js",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/gpac/mp4box.js.git"
  },
  "bugs": {
    "url": "https://github.com/gpac/mp4box.js/issues"
  },
  "author": {
    "name": "Cyril Concolato",
    "email": "cyril.concolato@telecom-paristech.fr",
    "url": "http://concolato.wp.mines-telecom.fr/"
  },
  "licenses": [
    {
      "type": "BSD-3-Clause",
      "url": "https://github.com/gpac/mp4box.js/blob/master/LICENSE"
    }
  ],
  "devDependencies": {
    "grunt-contrib-concat": "^0.5.0",
    "grunt-contrib-connect": "^0.8.0",
    "grunt-contrib-jshint": "^0.10.0",
    "grunt-contrib-qunit": "^0.5.2",
    "grunt-contrib-uglify": "^0.6.0",
    "grunt-contrib-watch": "^0.6.1",
    "qunitjs": "^1.15.0"
  },
  "scripts": {
    "test": "grunt --verbose"
  },
  "gitHead": "414178f55e645039ac97ca1d159f7f8cdaa4c146",
  "readme": "MP4Box.js\r\n======\r\n\r\n[![Build Status](https://travis-ci.org/gpac/mp4box.js.svg?branch=master)](https://travis-ci.org/gpac/mp4box.js)\r\n\r\nJavaScript library to process MP4 files in the browser, with support for progressive parsing. \r\nInspired by the [MP4Box](http://gpac.wp.mines-telecom.fr/mp4box/) tool from the [GPAC](http://gpac.wp.mines-telecom.fr) project. \r\nIt can be used to:\r\n- [get information about an MP4 file] (#getting-information), \r\n- [segment](#segmentation) an MP4 file for use with the [Media Source Extension API](https://dvcs.w3.org/hg/html-media/raw-file/tip/media-source/media-source.html),\r\n- [extract](#extraction) samples from an MP4 to create TextTracks.\r\n- more to come.\r\n\r\nA demo is available [here](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/) and the QUnit tests are [here](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/qunit.html)\r\n\r\nAPI\r\n===\r\n\r\n###Getting Information###\r\nSimilar to `MP4Box -info file.mp4`, MP4Box.js can provide general information about the file (duration, number and types of tracks ...). Create an MP4Box object, set the `onReady` callback and provide data in the form of ArrayBuffer objects. MP4Box.js supports progressive parsing. You can provide small buffers at a time, the callback will be called when the 'moov' box is parsed.\r\n\r\n```javascript\r\nvar mp4box = new MP4Box();\r\nmp4box.onError = function(e) {};\r\nmp4box.onReady = function(info) {};\r\nmp4box.appendBuffer(data);\r\nmp4box.appendBuffer(data);\r\nmp4box.appendBuffer(data);\r\n...\r\nmp4box.flush();\r\n```\r\n\r\n####onMoovStart()####\r\nThe `onMoovStart` callback is called when the 'moov' box is starting to be parsed, i.e. when the metadata about the file is parsed. Depending on the download speed, it may take a while to download the whole 'moov' box. The end of parsing is signaled by the `onReady` callback.\r\n\r\n```javascript\r\nmp4box.onMoovStart = function (info) {\r\n\tconsole.log(\"Starting to receive File Information\");\r\n}\r\n```\r\n\r\n####onReady(info)####\r\nThe `onReady` callback is called when the the 'moov' box has been parsed, i.e. when the metadata about the file is parsed. \r\n\r\n```javascript\r\nmp4box.onReady = function (info) {\r\n\tconsole.log(\"Received File Information\");\r\n}\r\n```\r\n\r\nThe `info` argument is an object with the following structure.\r\n```json\r\n{\r\n  \"duration\":360002,\r\n  \"timescale\":600,\r\n  \"isFragmented\":false,\r\n  \"isProgressive\":true,\r\n  \"hasIOD\":true,\r\n  \"brands\":[\"isom\"],\r\n  \"created\":\"2014-04-15T18:24:40.000Z\",\r\n  \"modified\":\"2014-04-15T18:24:40.000Z\",\r\n  \"tracks\":[\r\n    {\r\n\t  \"id\":2,\r\n\t  \"created\":\"2012-02-13T23:07:31.000Z\",\r\n\t  \"modified\":\"2014-04-16T12:22:56.000Z\",\r\n\t  \"movie_duration\":360000,\r\n\t  \"layer\":0,\r\n\t  \"alternate_group\":0,\r\n\t  \"volume\":0,\r\n\t  \"track_width\":320,\r\n\t  \"track_height\":180,\r\n\t  \"timescale\":25000,\r\n\t  \"duration\":15000000,\r\n\t  \"bitrate\":120000,\r\n\t  \"codec\":\"avc1.42c00d\",\r\n\t  \"video\":{\r\n\t    \"width\":320,\"height\":180\r\n\t  },\r\n\t  \"language\":\"und\",\r\n\t  \"nb_samples\":15000\r\n\t},\r\n\t{\r\n\t  \"id\":3,\r\n\t  \"created\":\"2012-09-12T11:14:57.000Z\",\r\n\t  \"modified\":\"2014-04-16T12:22:56.000Z\",\r\n\t  \"movie_duration\":360002,\r\n\t  \"layer\":0,\r\n\t  \"alternate_group\":0,\r\n\t  \"volume\":1,\r\n\t  \"track_width\":0,\r\n\t  \"track_height\":0,\r\n\t  \"timescale\":44100,\r\n\t  \"duration\":26460160,\r\n\t  \"bitrate\":60000,\r\n\t  \"codec\":\"mp4a.40.2\",\r\n\t  \"audio\":{\r\n\t    \"sample_rate\":44100,\r\n\t\t\"channel_count\":1,\r\n\t\t\"sample_size\":16\r\n\t  },\r\n\t  \"language\":\"und\",\r\n\t  \"nb_samples\":25840\r\n\t}\r\n  ]\r\n}\r\n```\r\n- **brands**: Array of 4CC codes corresponding to the file brands,\r\n- **created**: Date object, indicating the creation date of the file as given in the file header,\r\n- **modified**: Date object, indicating the last modification date of the file as given in the file header,\r\n- **timescale**: Number, corresponding to the timescale as given in the file header,\r\n- **duration**: Number, providing the duration of the movie (unfragmented part) in timescale units,\r\n- **isProgressive**: boolean, indicating if the file can be played progressively,\r\n- **isFragmented**: boolean, indicating if the file is already fragmented,\r\n- **fragment_duration**: Number, giving the duration of the fragmented part of the file, in timescale units,\r\n- **hasIOD**: boolean, indicating if the the file contains an MPEG-4 Initial Object Descriptor\r\n- **tracks**: Array of track information objects\r\n\r\nTrack information object:\r\n- **id**: Number, giving track identifier,\r\n- **created**: Date object, indicating the creation date of the file as given in the track header,\r\n- **modified**: Date object, indicating the last modification date of the file as given in the track header,\r\n- **alternate_group**: Number, identifier of the alternate group the track belongs to,\r\n- **timescale**: Number, indicating the track timescale, as given in the track header,\r\n- **duration**: Number, providing the duration of the (unfragmented part of) track, in timescale units,\r\n- **bitrate**: Number, providing the bitrate of the track in bits per second,\r\n- **nb_samples**: Number, giving the number of track samples (ie. frames),\r\n- **codec**: String, giving the MIME codecs parameter for this track (e.g. \"avc1.42c00d\" or \"mp4a.40.2\"), to be used to create SourceBuffer objects with [Media Source Extensions](https://dvcs.w3.org/hg/html-media/raw-file/tip/media-source/media-source.html),\r\n- **language**: String, giving the 3-letter language code,\r\n- **track_width**: Number, width of the track as indicated in the track header,\r\n- **track_height**: Number, height of the track as indicated in the track header,\r\n- **layer**: Number, layer information as indicated in the track header,\r\n- **video**: Object, information specific for video tracks\r\n- **audio**: Object, information specific for audio tracks\r\n\r\nVideo-specific information object:\r\n- **width**: Number, width of the video track as indicated in the media header,\r\n- **height**: Number, height of the video track as indicated in the media header,\r\n\r\nAudio-specific information object:\r\n- **sample_rate**: Number, sample rate as indicated in the media header,\r\n- **channel_count**: Number, number of channels as indicated in the media header,\r\n- **sample_size**: Number, size in bits of an uncompressed audio sample as indicated in the media header,\r\n\r\n####onError(e)####\r\nIndicates that an error has occured during the processing. `e` is a String.\r\n```javascript\r\nmp4box.onError = function (e) {\r\n\tconsole.log(\"Received Error Message \"+e);\r\n}\r\n```\r\n\r\n####appendBuffer(data)####\r\nProvides an ArrayBuffer to parse from. The ArrayBuffer must have a `fileStart` (Number) property indicating the 0-based position of first byte of the ArrayBuffer in the original file. Returns the offset (in the original file) that is expected to be the `fileStart` value of the next buffer. \r\n```javascript\r\nvar ab = getArrayBuffer();\r\nab.fileStart = 0;\r\nmp4box.appendBuffer(ab);\r\n```\r\n\r\n####flush()####\r\nIndicates that no more data will be received and that all remaining samples should be flushed in the segmentation or extraction process.\r\n\r\n###Segmentation###\r\n\r\n```javascript\r\nvar mp4box = new MP4Box();\r\nmp4box.onReady = function(info) {\r\n  ...\r\n  mp4box.onSegment = function (id, user, buffer) {}\r\n  mp4box.setSegmentOptions(info.tracks[0].id, sb, options);  \r\n  var initSegs = mp4box.initializeSegmentation();  \r\n  ...\r\n};\r\n```\r\n\r\n####setSegmentOptions(track_id, user, options)####\r\nIndicates that the track with the given `track_id` should be segmented, with the given options. When segments are ready, the callback [onSegment](#onsegmentid_user_buffer) is called with the `user` parameter. The `options` argument is an object with the following properties:\r\n- **nbSamples**: Number, representing the number of frames per segment, i.e. the time between 2 callbacks to onSegment. If not enough data is received to form a segment, received samples are kept. If not provided, the default is 1000.\r\n- **rapAlignement**: boolean, indicating if segments should start with a RAP. If not provided, the default is true.\r\n\r\n```javascript\r\nmp4box.setSegmentOptions(1, sb, { nbSamples: 1000 });\r\n```\r\n \r\n####unsetSegmentOptions(track_id)####\r\nIndicates that the track with the given `track_id` should not be segmented.\r\n```javascript\r\nmp4box.unsetSegmentOptions(1);\r\n```\r\n\r\n####onSegment(id, user, buffer)####\r\nCallback called when a segment is ready, according to the options passed in [setSegmentOptions](##setsegmentoptionstrack_id-user-options). `user` is the caller of the segmentation, for this track, and `buffer` is an ArrayBuffer containing the Movie Fragments for this segment.\r\n\r\n```javascript\r\nmp4box.onSegment = function (id, user, buffer) {\r\n\tconsole.log(\"Received segment on track \"+id+\" for object \"+user+\" with a length of \"+buffer.byteLength);\r\n}\r\n```\r\n\r\n####initializeSegmentation()####\r\nIndicates that the application is ready to receive segments. Returns an array of objects containing the following properties:\r\n- **id**: Number, the track id \r\n- **user**: Object, the caller of the segmentation for this track, as given in [setSegmentOptions](##setsegmentoptionstrack_id-user-options)\r\n- **buffer**: ArrayBuffer, the initialization segment for this track.\r\n\r\n```json\r\n[\r\n  {\r\n\t\"id\":2,\r\n\t\"buffer\":\"[ArrayBuffer]\",\r\n\t\"user\":\"[SourceBuffer]\"\r\n  },\r\n  {\r\n\t\"id\":3,\r\n\t\"buffer\":\"[ArrayBuffer]\",\r\n\t\"user\":\"[SourceBuffer]\"\r\n  }\r\n]\r\n```\r\n\r\n###Extraction###\r\nIt is possible to extract the samples of a track, in a similar manner to the segmentation process.\r\n```javascript\r\nvar mp4box = new MP4Box();\r\nmp4box.onReady = function(info) {\r\n  ...\r\n  /* create a texttrack */\r\n  var texttrack = v.addTextTrack(\"metadata\", \"Text track for extraction of track \"+info.tracks[0].id);\r\n  mp4box.onSamples = function (id, user, samples) {}\r\n  mp4box.setExtractionsOptions(info.tracks[0].id, texttrack, options);  \r\n  ...\r\n};\r\n```\r\n\r\n####setExtractionOptions(track_id, user, options)####\r\nIndicates that the track with the given `track_id` for which samples should be extracted, with the given options. When samples are ready, the callback [onSamples](#onsamplesid-user-samples) is called with the `user` parameter. The `options` argument is an object with the following properties:\r\n- **nbSamples**: Number, representing the number of samples per callback callt. If not enough data is received to extract the number of samples, the samples received so far are kept. If not provided, the default is 1000.\r\n- **rapAlignement**: boolean, indicating if sample arrays should start with a RAP. If not provided, the default is true.\r\n\r\n```javascript\r\nmp4box.setExtractionOptions(1, texttrack, { nbSamples: 1000 });\r\n```\r\n \r\n####unsetExtractionOptions(track_id)####\r\nIndicates that the samples for the track with the given `track_id` should not be extracted.\r\n```javascript\r\nmp4box.unsetExtractionOptions(1);\r\n```\r\n\r\n####onSamples(id, user, samples)####\r\nCallback called when a set of samples is ready, according to the options passed in [setExtractionOptions](#setextractionoptionstrack_id-user-options). `user` is the caller of the segmentation, for this track, and `samples` is an Array of samples.\r\n\r\n```javascript\r\nmp4box.onSamples = function (id, user, samples) {\r\n\tconsole.log(\"Received \"+samples.length+\" samples on track \"+id+\" for object \"+user);\r\n}\r\n```\r\n\r\nEach sample has the following structure:\r\n```json\r\n{\r\n\t\"track_id\":4,\r\n\t\"description\": [Box],\r\n\t\"is_rap\":true,\r\n\t\"timescale\":1000,\r\n\t\"dts\":0,\r\n\t\"cts\":0,\r\n\t\"duration\":1000,\r\n\t\"size\":41,\r\n\t\"data\": [ArrayBuffer]\r\n}\r\n```\r\n\r\n####seek(time, useRap)####\r\nIndicates that the next samples to process (for extraction or segmentation) start at the given time (Number, in seconds) or at the time of the previous Random Access Point (if useRap is true, default is false). Returns the offset in the file of the next bytes to be provided via [appendBuffer](#appendbufferdata) .\r\n```javascript\r\nmp4box.seek(10, true);\r\n```\r\n\r\nDependencies\r\n=======\r\nThis code uses [DataStream.js](https://github.com/kig/DataStream.js), with some modifications for Uint24 and Uint64 types.\r\n\r\nBrowser Usage\r\n=======\r\n\r\nThere is currently no build system. In order to use the `MP4Box.js` in a browser, you need to include all files as follows.\r\n\r\n```html\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <title>MP4Box.js in the browser</title>\r\n  <script src=\"log.js\"></script>\r\n  <script src=\"DataStream.js\"></script>\r\n  <script src=\"descriptor.js\"></script>\r\n  <script src=\"box.js\"></script>\r\n  <script src=\"text-mp4.js\"></script>\r\n  <script src=\"isofile.js\"></script>\r\n  <script src=\"mp4box.js\"></script>\r\n</head>\r\n<body>\r\n...\r\n</body>\r\n</html>\r\n```\r\n\r\n",
  "readmeFilename": "README.md",
  "_id": "mp4box@0.1.0",
  "_shasum": "c08d0f02cc06f13646db2ca1f4ac563a0dd07372",
  "_from": "git://github.com/jhiesey/mp4box.js.git#nodified",
  "_resolved": "git://github.com/jhiesey/mp4box.js.git#414178f55e645039ac97ca1d159f7f8cdaa4c146"
}
